import{e as Ke}from"../chunks/index.CzR0xuCU.js";import{s as be,n as x,o as Ge,d as ne,r as Qe}from"../chunks/scheduler.Cz3TSd7V.js";import{S as we,i as Ee,e as b,s as T,c as w,d as R,h as P,g as f,o as i,j as D,k as u,b as z,f as H,l as q,A as te,z as X,B as re,C as Be,u as Ye,x as Fe,y as Ve,m as he,n as me,p as ve,t as _e,a as de,r as ge}from"../chunks/index.DKOtY3uX.js";import{e as Ue,N as Ze}from"../chunks/Navbar.DGiOEIBM.js";import{g as xe}from"../chunks/entry.XM5ONYRv.js";import{U as pe,c as We,d as $e,h as et,g as tt,t as st,R as lt,v as at,w as rt,x as nt,b as it,u as ot}from"../chunks/APIAdapter.DEoGsArP.js";import{g as ie}from"../chunks/misc.B4lJbiPP.js";import{R as je}from"../chunks/limits.C1Ngrwk2.js";function ut({params:l}){if(l.id)return{id:l.id};Ke(404,"Not found")}const Ot=Object.freeze(Object.defineProperty({__proto__:null,load:ut},Symbol.toStringTag,{value:"Module"}));function Me(l){let e,s,t,a=l[1].name+"",n,o,h,v,_=l[0].title+"",k,p,C,d,r,m,c,N,L,V,A;function E(g,I){return g[7]?ft:ct}let S=E(l),O=S(l);return{c(){e=b("div"),s=b("h1"),t=b("a"),n=z(a),h=T(),v=b("h2"),k=z(_),p=T(),C=b("img"),r=T(),m=b("div"),c=b("p"),N=z(l[2]),V=T(),A=b("div"),O.c(),this.h()},l(g){e=w(g,"DIV",{class:!0});var I=R(e);s=w(I,"H1",{class:!0});var U=R(s);t=w(U,"A",{href:!0});var J=R(t);n=H(J,a),J.forEach(f),U.forEach(f),h=P(I),v=w(I,"H2",{class:!0});var G=R(v);k=H(G,_),G.forEach(f),I.forEach(f),p=P(g),C=w(g,"IMG",{src:!0,alt:!0,class:!0}),r=P(g),m=w(g,"DIV",{class:!0});var K=R(m);c=w(K,"P",{class:!0});var B=R(c);N=H(B,l[2]),B.forEach(f),K.forEach(f),V=P(g),A=w(g,"DIV",{class:!0});var j=R(A);O.l(j),j.forEach(f),this.h()},h(){i(t,"href",o="/artista/"+l[1].id),i(s,"class","artista"),i(v,"class","nombre_album svelte-1vscpua"),i(e,"class","datos svelte-1vscpua"),ne(C.src,d=l[0].cover)||i(C,"src",d),i(C,"alt","album_cover"),i(C,"class","portada svelte-1vscpua"),i(c,"class",L="rating "+ie(l[2])+" svelte-1vscpua"),i(m,"class","rating-wrapper svelte-1vscpua"),i(A,"class","form-section svelte-1vscpua")},m(g,I){D(g,e,I),u(e,s),u(s,t),u(t,n),u(e,h),u(e,v),u(v,k),D(g,p,I),D(g,C,I),D(g,r,I),D(g,m,I),u(m,c),u(c,N),D(g,V,I),D(g,A,I),O.m(A,null)},p(g,I){I&2&&a!==(a=g[1].name+"")&&q(n,a),I&2&&o!==(o="/artista/"+g[1].id)&&i(t,"href",o),I&1&&_!==(_=g[0].title+"")&&q(k,_),I&1&&!ne(C.src,d=g[0].cover)&&i(C,"src",d),I&4&&q(N,g[2]),I&4&&L!==(L="rating "+ie(g[2])+" svelte-1vscpua")&&i(c,"class",L),S===(S=E(g))&&O?O.p(g,I):(O.d(1),O=S(g),O&&(O.c(),O.m(A,null)))},d(g){g&&(f(e),f(p),f(C),f(r),f(m),f(V),f(A)),O.d()}}}function ct(l){let e,s="Logeate para escribir una review";return{c(){e=b("p"),e.textContent=s,this.h()},l(t){e=w(t,"P",{class:!0,"data-svelte-h":!0}),te(e)!=="svelte-12al56i"&&(e.textContent=s),this.h()},h(){i(e,"class","login-message svelte-1vscpua")},m(t,a){D(t,e,a)},p:x,d(t){t&&f(e)}}}function ft(l){let e,s,t,a,n,o="/ 100",h,v,_,k,p,C,d,r=l[6]&&ze(l);return{c(){e=b("form"),s=b("div"),t=b("input"),a=T(),n=b("p"),n.textContent=o,h=T(),r&&r.c(),v=T(),_=b("textarea"),k=T(),p=b("input"),this.h()},l(m){e=w(m,"FORM",{class:!0});var c=R(e);s=w(c,"DIV",{class:!0});var N=R(s);t=w(N,"INPUT",{placeholder:!0,class:!0,type:!0}),a=P(N),n=w(N,"P",{"data-svelte-h":!0}),te(n)!=="svelte-1e5wygq"&&(n.textContent=o),h=P(N),r&&r.l(N),N.forEach(f),v=P(c),_=w(c,"TEXTAREA",{id:!0,class:!0,placeholder:!0}),R(_).forEach(f),k=P(c),p=w(c,"INPUT",{type:!0,class:!0}),c.forEach(f),this.h()},h(){i(t,"placeholder","0-100"),i(t,"class","rating_input svelte-1vscpua"),i(t,"type","text"),i(s,"class","user_rating svelte-1vscpua"),i(_,"id","review"),i(_,"class","review_input svelte-1vscpua"),i(_,"placeholder","Escribe tu reseña aquí..."),i(p,"type","submit"),i(p,"class","submit svelte-1vscpua"),p.value="Enviar reseña",i(e,"class","svelte-1vscpua")},m(m,c){D(m,e,c),u(e,s),u(s,t),re(t,l[4]),u(s,a),u(s,n),u(s,h),r&&r.m(s,null),u(e,v),u(e,_),re(_,l[5]),u(e,k),u(e,p),C||(d=[X(t,"input",l[13]),X(t,"input",l[14]),X(_,"input",l[15]),X(_,"input",l[16]),X(e,"submit",l[9])],C=!0)},p(m,c){c&16&&t.value!==m[4]&&re(t,m[4]),m[6]?r?r.p(m,c):(r=ze(m),r.c(),r.m(s,null)):r&&(r.d(1),r=null),c&32&&re(_,m[5])},d(m){m&&f(e),r&&r.d(),C=!1,Qe(d)}}}function ze(l){let e,s;return{c(){e=b("p"),s=z(l[6]),this.h()},l(t){e=w(t,"P",{class:!0,style:!0});var a=R(e);s=H(a,l[6]),a.forEach(f),this.h()},h(){i(e,"class","submission-message svelte-1vscpua"),Be(e,"color",l[3])},m(t,a){D(t,e,a),u(e,s)},p(t,a){a&64&&q(s,t[6]),a&8&&Be(e,"color",t[3])},d(t){t&&f(e)}}}function He(l){let e,s="Borrar Album",t,a;return{c(){e=b("button"),e.textContent=s,this.h()},l(n){e=w(n,"BUTTON",{class:!0,"data-svelte-h":!0}),te(e)!=="svelte-17jgol9"&&(e.textContent=s),this.h()},h(){i(e,"class","admin-button bg-red svelte-1vscpua")},m(n,o){D(n,e,o),t||(a=X(e,"click",l[10]),t=!0)},p:x,d(n){n&&f(e),t=!1,a()}}}function ht(l){let e,s,t=l[0]&&l[1]&&Me(l),a=l[8]&&l[8].role&&He(l);return{c(){e=b("section"),t&&t.c(),s=T(),a&&a.c(),this.h()},l(n){e=w(n,"SECTION",{class:!0});var o=R(e);t&&t.l(o),s=P(o),a&&a.l(o),o.forEach(f),this.h()},h(){i(e,"class","svelte-1vscpua")},m(n,o){D(n,e,o),t&&t.m(e,null),u(e,s),a&&a.m(e,null)},p(n,[o]){n[0]&&n[1]?t?t.p(n,o):(t=Me(n),t.c(),t.m(e,s)):t&&(t.d(1),t=null),n[8]&&n[8].role?a?a.p(n,o):(a=He(n),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:x,o:x,d(n){n&&f(e),t&&t.d(),a&&a.d()}}}function mt(l){const e=parseInt(l,10);return!isNaN(e)&&e>=0&&e<=100}function vt(l,e,s){let{id:t}=e,{album:a=null}=e,{artist:n=null}=e,{avg_rating:o=0}=e,{userId:h=""}=e,{messageColor:v="red"}=e,_="",k="",p="",C=!1,d=null,r=null;Ge(async()=>{try{if(d=localStorage.getItem("token"),d){const E=JSON.parse(localStorage.getItem("user")||"");s(8,r=E?pe.fromObject(E):null),s(7,C=!0),r&&s(11,h=r.id)}if(s(0,a=await We(t)),a){s(1,n=await $e(a.artist));const E=await et(a.id);s(2,o=E||0)}}catch(E){console.error("Failed to fetch artist data:",E)}});async function m(E){if(E.preventDefault(),!mt(_)){s(3,v="red"),s(6,p="Por favor, ingresa una calificación válida entre 0 y 100.");return}try{const S=parseInt(_,10),O=await tt(),g=O.find(I=>I.userId===h&&I.albumId===a.id);if(console.log(O),g)g.ratingScore=S,g.content=k,g.fecha=new Date,await st(g,d||"")?(s(3,v="green"),s(6,p="¡Reseña actualizada con éxito!"),s(4,_=""),s(5,k=""),window.location.reload()):(s(3,v="red"),s(6,p="No se pudo actualizar la reseña. Inténtalo más tarde."));else{const I=new lt(`${Date.now()}`,h,S,k,new Date,0,a.id,[],[]);await at(I,d??"")?(s(3,v="green"),s(6,p="¡Reseña enviada con éxito!"),s(4,_=""),s(5,k=""),window.location.reload()):(s(3,v="red"),s(6,p="No se pudo enviar la reseña. Inténtalo más tarde."))}}catch(S){console.error("Error al enviar la reseña:",S),s(3,v="red"),s(6,p="Ocurrió un error al enviar la reseña.")}}async function c(){a&&await rt(a.id??"",d??""),xe("/")}function N(){_=this.value,s(4,_)}const L=()=>s(6,p="");function V(){k=this.value,s(5,k)}const A=()=>s(6,p="");return l.$$set=E=>{"id"in E&&s(12,t=E.id),"album"in E&&s(0,a=E.album),"artist"in E&&s(1,n=E.artist),"avg_rating"in E&&s(2,o=E.avg_rating),"userId"in E&&s(11,h=E.userId),"messageColor"in E&&s(3,v=E.messageColor)},[a,n,o,v,_,k,p,C,r,m,c,h,t,N,L,V,A]}class _t extends we{constructor(e){super(),Ee(this,e,vt,ht,be,{id:12,album:0,artist:1,avg_rating:2,userId:11,messageColor:3})}}function qe(l,e,s){const t=l.slice();return t[11]=e[s],t}function Je(l){var Re;let e,s,t,a,n=l[11].ratingScore+"",o,h,v,_,k,p,C,d,r,m,c=(((Re=l[1][l[11].userId])==null?void 0:Re.name)||l[11].userId)+"",N,L,V,A,E,S,O,g,I,U,J=l[3][l[11].id]+"",G,K,B,j,ke='<img src="https://via.placeholder.com/50" alt="" class="svelte-1nmbk2"/>',se,oe,Q,$=l[11].fecha.toLocaleDateString("es-ES")+"",le,ue,Y,ee=l[5](l[11].content)+"",ae,ce,fe,Ie;function Xe(){return l[7](l[11])}return{c(){e=b("div"),s=b("div"),t=b("div"),a=b("p"),o=z(n),v=T(),_=b("a"),k=b("img"),d=T(),r=b("p"),m=b("a"),N=z(c),V=T(),A=b("div"),E=b("button"),S=Fe("svg"),O=Fe("path"),I=T(),U=b("p"),G=z(J),K=T(),B=b("a"),j=b("button"),j.innerHTML=ke,oe=T(),Q=b("p"),le=z($),ue=T(),Y=b("p"),ae=z(ee),ce=T(),this.h()},l(M){e=w(M,"DIV",{class:!0});var y=R(e);s=w(y,"DIV",{class:!0});var W=R(s);t=w(W,"DIV",{class:!0});var F=R(t);a=w(F,"P",{class:!0});var Ce=R(a);o=H(Ce,n),Ce.forEach(f),v=P(F),_=w(F,"A",{href:!0});var Se=R(_);k=w(Se,"IMG",{src:!0,alt:!0,class:!0}),Se.forEach(f),d=P(F),r=w(F,"P",{});var Ae=R(r);m=w(Ae,"A",{href:!0});var Ne=R(m);N=H(Ne,c),Ne.forEach(f),Ae.forEach(f),V=P(F),A=w(F,"DIV",{class:!0});var Z=R(A);E=w(Z,"BUTTON",{class:!0});var Oe=R(E);S=Ve(Oe,"svg",{class:!0,height:!0,fill:!0,viewBox:!0,width:!0,xmlns:!0});var Te=R(S);O=Ve(Te,"path",{d:!0}),R(O).forEach(f),Te.forEach(f),Oe.forEach(f),I=P(Z),U=w(Z,"P",{class:!0});var Pe=R(U);G=H(Pe,J),Pe.forEach(f),K=P(Z),B=w(Z,"A",{class:!0,href:!0});var ye=R(B);j=w(ye,"BUTTON",{class:!0,"data-svelte-h":!0}),te(j)!=="svelte-ssgfop"&&(j.innerHTML=ke),ye.forEach(f),Z.forEach(f),F.forEach(f),oe=P(W),Q=w(W,"P",{class:!0});var De=R(Q);le=H(De,$),De.forEach(f),W.forEach(f),ue=P(y),Y=w(y,"P",{class:!0});var Le=R(Y);ae=H(Le,ee),Le.forEach(f),ce=P(y),y.forEach(f),this.h()},h(){var M;i(a,"class",h="rating "+ie(l[11].ratingScore)+" svelte-1nmbk2"),ne(k.src,p=((M=l[1][l[11].userId])==null?void 0:M.profile_picture)||"https://via.placeholder.com/50")||i(k,"src",p),i(k,"alt","Avatar"),i(k,"class","avatar svelte-1nmbk2"),i(_,"href",C=`/usuario/${l[11].userId}`),i(m,"href",L=`/usuario/${l[11].userId}`),i(O,"d","m248.367188 448.496094c2.359374 1.394531 4.996093 2.082031 7.632812 2.082031s5.273438-.6875 7.632812-2.082031c10.398438-6.152344 255.613282-152.242188 248.203126-309.316406-3.632813-77.175782-63.378907-138.078126-134.769532-138.648438-61.941406-1.390625-100.558594 42.121094-121.066406 80.53125-20.40625-38.191406-59.363281-80.53125-120.042969-80.53125-.351562 0-.6875 0-1.023437 0-71.390625.574219-131.136719 61.472656-134.769532 138.648438-7.410156 157.074218 237.800782 303.164062 248.203126 309.316406zm0 0"),i(S,"class","heart svelte-1nmbk2"),i(S,"height","20px"),i(S,"fill",g=l[2][l[11].id]?"#ff6666":"#222"),i(S,"viewBox","0 -30 511.99938 511"),i(S,"width","20px"),i(S,"xmlns","http://www.w3.org/2000/svg"),i(E,"class","likes_button svelte-1nmbk2"),i(U,"class","likes-no svelte-1nmbk2"),i(j,"class","svelte-1nmbk2"),i(B,"class","more_review svelte-1nmbk2"),i(B,"href",se="/review/"+l[11].id),i(A,"class","likes svelte-1nmbk2"),i(t,"class","info_usuario svelte-1nmbk2"),i(Q,"class","fecha svelte-1nmbk2"),i(s,"class","usuario"),i(Y,"class","review-texto"),i(e,"class","review svelte-1nmbk2")},m(M,y){D(M,e,y),u(e,s),u(s,t),u(t,a),u(a,o),u(t,v),u(t,_),u(_,k),u(t,d),u(t,r),u(r,m),u(m,N),u(t,V),u(t,A),u(A,E),u(E,S),u(S,O),u(A,I),u(A,U),u(U,G),u(A,K),u(A,B),u(B,j),u(s,oe),u(s,Q),u(Q,le),u(e,ue),u(e,Y),u(Y,ae),u(e,ce),fe||(Ie=X(E,"click",Xe),fe=!0)},p(M,y){var W,F;l=M,y&1&&n!==(n=l[11].ratingScore+"")&&q(o,n),y&1&&h!==(h="rating "+ie(l[11].ratingScore)+" svelte-1nmbk2")&&i(a,"class",h),y&3&&!ne(k.src,p=((W=l[1][l[11].userId])==null?void 0:W.profile_picture)||"https://via.placeholder.com/50")&&i(k,"src",p),y&1&&C!==(C=`/usuario/${l[11].userId}`)&&i(_,"href",C),y&3&&c!==(c=(((F=l[1][l[11].userId])==null?void 0:F.name)||l[11].userId)+"")&&q(N,c),y&1&&L!==(L=`/usuario/${l[11].userId}`)&&i(m,"href",L),y&5&&g!==(g=l[2][l[11].id]?"#ff6666":"#222")&&i(S,"fill",g),y&9&&J!==(J=l[3][l[11].id]+"")&&q(G,J),y&1&&se!==(se="/review/"+l[11].id)&&i(B,"href",se),y&1&&$!==($=l[11].fecha.toLocaleDateString("es-ES")+"")&&q(le,$),y&1&&ee!==(ee=l[5](l[11].content)+"")&&q(ae,ee)},d(M){M&&f(e),fe=!1,Ie()}}}function dt(l){let e,s=Ue(l[0]),t=[];for(let a=0;a<s.length;a+=1)t[a]=Je(qe(l,s,a));return{c(){e=b("section");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=w(a,"SECTION",{class:!0});var n=R(e);for(let o=0;o<t.length;o+=1)t[o].l(n);n.forEach(f),this.h()},h(){i(e,"class","svelte-1nmbk2")},m(a,n){D(a,e,n);for(let o=0;o<t.length;o+=1)t[o]&&t[o].m(e,null)},p(a,[n]){if(n&63){s=Ue(a[0]);let o;for(o=0;o<s.length;o+=1){const h=qe(a,s,o);t[o]?t[o].p(h,n):(t[o]=Je(h),t[o].c(),t[o].m(e,null))}for(;o<t.length;o+=1)t[o].d(1);t.length=s.length}},i:x,o:x,d(a){a&&f(e),Ye(t,a)}}}function gt(l,e,s){let{id:t}=e,{reviews:a=[]}=e,n={},o=null,h={},v={},_={};async function k(r){try{return await it(r)}catch(m){return console.error(`Error fetching user ${r}:`,m),null}}Ge(async()=>{try{const r=JSON.parse(localStorage.getItem("user")||"{}");o=r?pe.fromObject(r):null;const m=await We(t);if(m){s(0,a=await nt(m.reviews));for(const c of a)n[c.userId]||s(1,n[c.userId]=await k(c.userId),n),o?s(2,h[c.id]=c.userLikes.includes(o.id),h):s(2,h[c.id]=!1,h),s(3,v[c.id]=c.likes,v),_[c.id]=!1}}catch(r){console.error("Failed to fetch album data:",r)}});async function p(r){let m=localStorage.getItem("token"),c=pe.fromObject(JSON.parse(localStorage.getItem("user")||""));if(!(!m||!c)){if(_[r]){console.log("Please wait before liking again.");return}h[r]?s(3,v[r]-=1,v):s(3,v[r]+=1,v),s(2,h[r]=!h[r],h);try{await ot(r,m,v[r],c.id),console.log("Review like updated successfully")}catch(N){console.error("Error updating review like:",N),s(2,h[r]=!h[r],h),s(3,v[r]+=h[r]?1:-1,v)}_[r]=!0,setTimeout(()=>{_[r]=!1},2e3)}}function C(r){return r.length>je?r.slice(0,je)+"...":r}const d=r=>p(r.id);return l.$$set=r=>{"id"in r&&s(6,t=r.id),"reviews"in r&&s(0,a=r.reviews)},[a,n,h,v,p,C,t,d]}class pt extends we{constructor(e){super(),Ee(this,e,gt,dt,be,{id:6,reviews:0})}}function bt(l){let e,s,t,a,n,o,h,v,_="Reviews recientes",k,p,C;return e=new Ze({}),n=new _t({props:{id:l[0].id}}),p=new pt({props:{id:l[0].id}}),{c(){he(e.$$.fragment),s=T(),t=b("main"),a=b("section"),he(n.$$.fragment),o=T(),h=b("section"),v=b("h2"),v.textContent=_,k=T(),he(p.$$.fragment),this.h()},l(d){me(e.$$.fragment,d),s=P(d),t=w(d,"MAIN",{class:!0});var r=R(t);a=w(r,"SECTION",{class:!0});var m=R(a);me(n.$$.fragment,m),m.forEach(f),o=P(r),h=w(r,"SECTION",{class:!0});var c=R(h);v=w(c,"H2",{class:!0,"data-svelte-h":!0}),te(v)!=="svelte-ocb0vo"&&(v.textContent=_),k=P(c),me(p.$$.fragment,c),c.forEach(f),r.forEach(f),this.h()},h(){i(a,"class","section-body"),i(v,"class","section-title"),i(h,"class","section-body"),i(t,"class","svelte-163ahgl")},m(d,r){ve(e,d,r),D(d,s,r),D(d,t,r),u(t,a),ve(n,a,null),u(t,o),u(t,h),u(h,v),u(h,k),ve(p,h,null),C=!0},p(d,[r]){const m={};r&1&&(m.id=d[0].id),n.$set(m);const c={};r&1&&(c.id=d[0].id),p.$set(c)},i(d){C||(_e(e.$$.fragment,d),_e(n.$$.fragment,d),_e(p.$$.fragment,d),C=!0)},o(d){de(e.$$.fragment,d),de(n.$$.fragment,d),de(p.$$.fragment,d),C=!1},d(d){d&&(f(s),f(t)),ge(e,d),ge(n),ge(p)}}}function wt(l,e,s){let{data:t}=e;return l.$$set=a=>{"data"in a&&s(0,t=a.data)},[t]}class Tt extends we{constructor(e){super(),Ee(this,e,wt,bt,be,{data:0})}}export{Tt as component,Ot as universal};
