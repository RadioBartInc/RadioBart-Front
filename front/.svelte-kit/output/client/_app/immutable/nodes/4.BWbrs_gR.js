import{e as Xe}from"../chunks/index.CzR0xuCU.js";import{s as be,n as ee,o as Je,d as ae,r as Ke}from"../chunks/scheduler.Cz3TSd7V.js";import{S as ke,i as Ee,e as b,c as k,d as I,g as f,o as i,j as y,b as j,s as N,f as z,h as P,k as o,l as H,A as ne,B as re,z as Z,C as Le,u as Qe,x as Fe,y as Ve,m as he,n as me,p as _e,t as ve,a as de,r as ge}from"../chunks/index.DKOtY3uX.js";import{e as Be,N as Ye}from"../chunks/Navbar.CYHUjA86.js";import{U as pe,c as Ge,d as Ze,f as xe,g as $e,q as et,R as tt,s as st,t as lt,b as rt,u as at}from"../chunks/APIAdapter.CWbTadu6.js";import{g as ie}from"../chunks/misc.B4lJbiPP.js";import{R as Me}from"../chunks/limits.C1Ngrwk2.js";function it({params:l}){if(l.id)return{id:l.id};Xe(404,"Not found")}const Rt=Object.freeze(Object.defineProperty({__proto__:null,load:it},Symbol.toStringTag,{value:"Module"}));function Ue(l){let t,e,s,r=l[1].name+"",h,n,_,E,d=l[0].title+"",w,p,q,a,u,c,g,O,D,V,m;function T(v,R){return v[7]?ot:nt}let C=T(l),S=C(l);return{c(){t=b("div"),e=b("h1"),s=b("a"),h=j(r),_=N(),E=b("h2"),w=j(d),p=N(),q=b("img"),u=N(),c=b("div"),g=b("p"),O=j(l[2]),V=N(),m=b("div"),S.c(),this.h()},l(v){t=k(v,"DIV",{class:!0});var R=I(t);e=k(R,"H1",{class:!0});var U=I(e);s=k(U,"A",{href:!0});var J=I(s);h=z(J,r),J.forEach(f),U.forEach(f),_=P(R),E=k(R,"H2",{class:!0});var G=I(E);w=z(G,d),G.forEach(f),R.forEach(f),p=P(v),q=k(v,"IMG",{src:!0,alt:!0,class:!0}),u=P(v),c=k(v,"DIV",{class:!0});var X=I(c);g=k(X,"P",{class:!0});var L=I(g);O=z(L,l[2]),L.forEach(f),X.forEach(f),V=P(v),m=k(v,"DIV",{class:!0});var B=I(m);S.l(B),B.forEach(f),this.h()},h(){i(s,"href",n="/artista/"+l[1].id),i(e,"class","artista"),i(E,"class","nombre_album svelte-kislqq"),i(t,"class","datos svelte-kislqq"),ae(q.src,a=l[0].cover)||i(q,"src",a),i(q,"alt","album_cover"),i(q,"class","portada svelte-kislqq"),i(g,"class",D="rating "+ie(l[2])+" svelte-kislqq"),i(c,"class","rating-wrapper svelte-kislqq"),i(m,"class","form-section svelte-kislqq")},m(v,R){y(v,t,R),o(t,e),o(e,s),o(s,h),o(t,_),o(t,E),o(E,w),y(v,p,R),y(v,q,R),y(v,u,R),y(v,c,R),o(c,g),o(g,O),y(v,V,R),y(v,m,R),S.m(m,null)},p(v,R){R&2&&r!==(r=v[1].name+"")&&H(h,r),R&2&&n!==(n="/artista/"+v[1].id)&&i(s,"href",n),R&1&&d!==(d=v[0].title+"")&&H(w,d),R&1&&!ae(q.src,a=v[0].cover)&&i(q,"src",a),R&4&&H(O,v[2]),R&4&&D!==(D="rating "+ie(v[2])+" svelte-kislqq")&&i(g,"class",D),C===(C=T(v))&&S?S.p(v,R):(S.d(1),S=C(v),S&&(S.c(),S.m(m,null)))},d(v){v&&(f(t),f(p),f(q),f(u),f(c),f(V),f(m)),S.d()}}}function nt(l){let t,e="Logeate para escribir una review";return{c(){t=b("p"),t.textContent=e,this.h()},l(s){t=k(s,"P",{class:!0,"data-svelte-h":!0}),ne(t)!=="svelte-12al56i"&&(t.textContent=e),this.h()},h(){i(t,"class","login-message svelte-kislqq")},m(s,r){y(s,t,r)},p:ee,d(s){s&&f(t)}}}function ot(l){let t,e,s,r,h,n="/ 100",_,E,d,w,p,q,a,u=l[6]&&je(l);return{c(){t=b("form"),e=b("div"),s=b("input"),r=N(),h=b("p"),h.textContent=n,_=N(),u&&u.c(),E=N(),d=b("textarea"),w=N(),p=b("input"),this.h()},l(c){t=k(c,"FORM",{class:!0});var g=I(t);e=k(g,"DIV",{class:!0});var O=I(e);s=k(O,"INPUT",{placeholder:!0,class:!0,type:!0}),r=P(O),h=k(O,"P",{"data-svelte-h":!0}),ne(h)!=="svelte-1e5wygq"&&(h.textContent=n),_=P(O),u&&u.l(O),O.forEach(f),E=P(g),d=k(g,"TEXTAREA",{id:!0,class:!0,placeholder:!0}),I(d).forEach(f),w=P(g),p=k(g,"INPUT",{type:!0,class:!0}),g.forEach(f),this.h()},h(){i(s,"placeholder","0-100"),i(s,"class","rating_input svelte-kislqq"),i(s,"type","text"),i(e,"class","user_rating svelte-kislqq"),i(d,"id","review"),i(d,"class","review_input svelte-kislqq"),i(d,"placeholder","Escribe tu reseña aquí..."),i(p,"type","submit"),i(p,"class","submit svelte-kislqq"),p.value="Enviar reseña",i(t,"class","svelte-kislqq")},m(c,g){y(c,t,g),o(t,e),o(e,s),re(s,l[4]),o(e,r),o(e,h),o(e,_),u&&u.m(e,null),o(t,E),o(t,d),re(d,l[5]),o(t,w),o(t,p),q||(a=[Z(s,"input",l[11]),Z(s,"input",l[12]),Z(d,"input",l[13]),Z(d,"input",l[14]),Z(t,"submit",l[8])],q=!0)},p(c,g){g&16&&s.value!==c[4]&&re(s,c[4]),c[6]?u?u.p(c,g):(u=je(c),u.c(),u.m(e,null)):u&&(u.d(1),u=null),g&32&&re(d,c[5])},d(c){c&&f(t),u&&u.d(),q=!1,Ke(a)}}}function je(l){let t,e;return{c(){t=b("p"),e=j(l[6]),this.h()},l(s){t=k(s,"P",{class:!0,style:!0});var r=I(t);e=z(r,l[6]),r.forEach(f),this.h()},h(){i(t,"class","submission-message svelte-kislqq"),Le(t,"color",l[3])},m(s,r){y(s,t,r),o(t,e)},p(s,r){r&64&&H(e,s[6]),r&8&&Le(t,"color",s[3])},d(s){s&&f(t)}}}function ut(l){let t,e=l[0]&&l[1]&&Ue(l);return{c(){t=b("section"),e&&e.c(),this.h()},l(s){t=k(s,"SECTION",{class:!0});var r=I(t);e&&e.l(r),r.forEach(f),this.h()},h(){i(t,"class","svelte-kislqq")},m(s,r){y(s,t,r),e&&e.m(t,null)},p(s,[r]){s[0]&&s[1]?e?e.p(s,r):(e=Ue(s),e.c(),e.m(t,null)):e&&(e.d(1),e=null)},i:ee,o:ee,d(s){s&&f(t),e&&e.d()}}}function ct(l){const t=parseInt(l,10);return!isNaN(t)&&t>=0&&t<=100}function ft(l,t,e){let{id:s}=t,{album:r=null}=t,{artist:h=null}=t,{avg_rating:n=0}=t,{userId:_=""}=t,{messageColor:E="red"}=t,d="",w="",p="",q=!1,a=null,u=null;Je(async()=>{try{if(a=localStorage.getItem("token"),a){const m=JSON.parse(localStorage.getItem("user")||"");u=m?pe.fromObject(m):null,e(7,q=!0),u&&e(9,_=u.id)}if(e(0,r=await Ge(s)),r){e(1,h=await Ze(r.artist));const m=await xe(r.id);e(2,n=m||0)}}catch(m){console.error("Failed to fetch artist data:",m)}});async function c(m){if(m.preventDefault(),!ct(d)){e(3,E="red"),e(6,p="Por favor, ingresa una calificación válida entre 0 y 100.");return}try{const T=parseInt(d,10),C=await $e(),S=C.find(v=>v.userId===_&&v.albumId===r.id);if(console.log(C),S)S.ratingScore=T,S.content=w,S.fecha=new Date,await et(S,a||"")?(e(3,E="green"),e(6,p="¡Reseña actualizada con éxito!"),e(4,d=""),e(5,w="")):(e(3,E="red"),e(6,p="No se pudo actualizar la reseña. Inténtalo más tarde."));else{const v=new tt(`${Date.now()}`,_,T,w,new Date,0,r.id,[],[]);await st(v,a??"")?(e(3,E="green"),e(6,p="¡Reseña enviada con éxito!"),e(4,d=""),e(5,w="")):(e(3,E="red"),e(6,p="No se pudo enviar la reseña. Inténtalo más tarde."))}}catch(T){console.error("Error al enviar la reseña:",T),e(3,E="red"),e(6,p="Ocurrió un error al enviar la reseña.")}}function g(){d=this.value,e(4,d)}const O=()=>e(6,p="");function D(){w=this.value,e(5,w)}const V=()=>e(6,p="");return l.$$set=m=>{"id"in m&&e(10,s=m.id),"album"in m&&e(0,r=m.album),"artist"in m&&e(1,h=m.artist),"avg_rating"in m&&e(2,n=m.avg_rating),"userId"in m&&e(9,_=m.userId),"messageColor"in m&&e(3,E=m.messageColor)},[r,h,n,E,d,w,p,q,c,_,s,g,O,D,V]}class ht extends ke{constructor(t){super(),Ee(this,t,ft,ut,be,{id:10,album:0,artist:1,avg_rating:2,userId:9,messageColor:3})}}function ze(l,t,e){const s=l.slice();return s[10]=t[e],s}function He(l){var qe;let t,e,s,r,h=l[10].ratingScore+"",n,_,E,d,w,p,q,a,u,c,g=(((qe=l[1][l[10].userId])==null?void 0:qe.name)||l[10].userId)+"",O,D,V,m,T,C,S,v,R,U,J=l[3][l[10].id]+"",G,X,L,B,we='<img src="https://via.placeholder.com/50" alt="" class="svelte-1nmbk2"/>',te,oe,K,x=l[10].fecha.toLocaleDateString("es-ES")+"",se,ue,Q,$=l[5](l[10].content)+"",le,ce,fe,Ie;function We(){return l[7](l[10])}return{c(){t=b("div"),e=b("div"),s=b("div"),r=b("p"),n=j(h),E=N(),d=b("a"),w=b("img"),a=N(),u=b("p"),c=b("a"),O=j(g),V=N(),m=b("div"),T=b("button"),C=Fe("svg"),S=Fe("path"),R=N(),U=b("p"),G=j(J),X=N(),L=b("a"),B=b("button"),B.innerHTML=we,oe=N(),K=b("p"),se=j(x),ue=N(),Q=b("p"),le=j($),ce=N(),this.h()},l(M){t=k(M,"DIV",{class:!0});var A=I(t);e=k(A,"DIV",{class:!0});var W=I(e);s=k(W,"DIV",{class:!0});var F=I(s);r=k(F,"P",{class:!0});var Re=I(r);n=z(Re,h),Re.forEach(f),E=P(F),d=k(F,"A",{href:!0});var Se=I(d);w=k(Se,"IMG",{src:!0,alt:!0,class:!0}),Se.forEach(f),a=P(F),u=k(F,"P",{});var Ce=I(u);c=k(Ce,"A",{href:!0});var Ae=I(c);O=z(Ae,g),Ae.forEach(f),Ce.forEach(f),V=P(F),m=k(F,"DIV",{class:!0});var Y=I(m);T=k(Y,"BUTTON",{class:!0});var Ne=I(T);C=Ve(Ne,"svg",{class:!0,height:!0,fill:!0,viewBox:!0,width:!0,xmlns:!0});var Pe=I(C);S=Ve(Pe,"path",{d:!0}),I(S).forEach(f),Pe.forEach(f),Ne.forEach(f),R=P(Y),U=k(Y,"P",{class:!0});var Oe=I(U);G=z(Oe,J),Oe.forEach(f),X=P(Y),L=k(Y,"A",{class:!0,href:!0});var Te=I(L);B=k(Te,"BUTTON",{class:!0,"data-svelte-h":!0}),ne(B)!=="svelte-ssgfop"&&(B.innerHTML=we),Te.forEach(f),Y.forEach(f),F.forEach(f),oe=P(W),K=k(W,"P",{class:!0});var ye=I(K);se=z(ye,x),ye.forEach(f),W.forEach(f),ue=P(A),Q=k(A,"P",{class:!0});var De=I(Q);le=z(De,$),De.forEach(f),ce=P(A),A.forEach(f),this.h()},h(){var M;i(r,"class",_="rating "+ie(l[10].ratingScore)+" svelte-1nmbk2"),ae(w.src,p=((M=l[1][l[10].userId])==null?void 0:M.profile_picture)||"https://via.placeholder.com/50")||i(w,"src",p),i(w,"alt","Avatar"),i(w,"class","avatar svelte-1nmbk2"),i(d,"href",q=`/usuario/${l[10].userId}`),i(c,"href",D=`/usuario/${l[10].userId}`),i(S,"d","m248.367188 448.496094c2.359374 1.394531 4.996093 2.082031 7.632812 2.082031s5.273438-.6875 7.632812-2.082031c10.398438-6.152344 255.613282-152.242188 248.203126-309.316406-3.632813-77.175782-63.378907-138.078126-134.769532-138.648438-61.941406-1.390625-100.558594 42.121094-121.066406 80.53125-20.40625-38.191406-59.363281-80.53125-120.042969-80.53125-.351562 0-.6875 0-1.023437 0-71.390625.574219-131.136719 61.472656-134.769532 138.648438-7.410156 157.074218 237.800782 303.164062 248.203126 309.316406zm0 0"),i(C,"class","heart svelte-1nmbk2"),i(C,"height","20px"),i(C,"fill",v=l[2][l[10].id]?"#ff6666":"#222"),i(C,"viewBox","0 -30 511.99938 511"),i(C,"width","20px"),i(C,"xmlns","http://www.w3.org/2000/svg"),i(T,"class","likes_button svelte-1nmbk2"),i(U,"class","likes-no svelte-1nmbk2"),i(B,"class","svelte-1nmbk2"),i(L,"class","more_review svelte-1nmbk2"),i(L,"href",te="/review/"+l[10].id),i(m,"class","likes svelte-1nmbk2"),i(s,"class","info_usuario svelte-1nmbk2"),i(K,"class","fecha svelte-1nmbk2"),i(e,"class","usuario"),i(Q,"class","review-texto"),i(t,"class","review svelte-1nmbk2")},m(M,A){y(M,t,A),o(t,e),o(e,s),o(s,r),o(r,n),o(s,E),o(s,d),o(d,w),o(s,a),o(s,u),o(u,c),o(c,O),o(s,V),o(s,m),o(m,T),o(T,C),o(C,S),o(m,R),o(m,U),o(U,G),o(m,X),o(m,L),o(L,B),o(e,oe),o(e,K),o(K,se),o(t,ue),o(t,Q),o(Q,le),o(t,ce),fe||(Ie=Z(T,"click",We),fe=!0)},p(M,A){var W,F;l=M,A&1&&h!==(h=l[10].ratingScore+"")&&H(n,h),A&1&&_!==(_="rating "+ie(l[10].ratingScore)+" svelte-1nmbk2")&&i(r,"class",_),A&3&&!ae(w.src,p=((W=l[1][l[10].userId])==null?void 0:W.profile_picture)||"https://via.placeholder.com/50")&&i(w,"src",p),A&1&&q!==(q=`/usuario/${l[10].userId}`)&&i(d,"href",q),A&3&&g!==(g=(((F=l[1][l[10].userId])==null?void 0:F.name)||l[10].userId)+"")&&H(O,g),A&1&&D!==(D=`/usuario/${l[10].userId}`)&&i(c,"href",D),A&5&&v!==(v=l[2][l[10].id]?"#ff6666":"#222")&&i(C,"fill",v),A&9&&J!==(J=l[3][l[10].id]+"")&&H(G,J),A&1&&te!==(te="/review/"+l[10].id)&&i(L,"href",te),A&1&&x!==(x=l[10].fecha.toLocaleDateString("es-ES")+"")&&H(se,x),A&1&&$!==($=l[5](l[10].content)+"")&&H(le,$)},d(M){M&&f(t),fe=!1,Ie()}}}function mt(l){let t,e=Be(l[0]),s=[];for(let r=0;r<e.length;r+=1)s[r]=He(ze(l,e,r));return{c(){t=b("section");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){t=k(r,"SECTION",{class:!0});var h=I(t);for(let n=0;n<s.length;n+=1)s[n].l(h);h.forEach(f),this.h()},h(){i(t,"class","svelte-1nmbk2")},m(r,h){y(r,t,h);for(let n=0;n<s.length;n+=1)s[n]&&s[n].m(t,null)},p(r,[h]){if(h&63){e=Be(r[0]);let n;for(n=0;n<e.length;n+=1){const _=ze(r,e,n);s[n]?s[n].p(_,h):(s[n]=He(_),s[n].c(),s[n].m(t,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=e.length}},i:ee,o:ee,d(r){r&&f(t),Qe(s,r)}}}function _t(l,t,e){let{id:s}=t,{reviews:r=[]}=t,h={},n={},_={},E={};async function d(a){try{return await rt(a)}catch(u){return console.error(`Error fetching user ${a}:`,u),null}}Je(async()=>{try{let a=pe.fromObject(JSON.parse(localStorage.getItem("user")||""));const u=await Ge(s);if(u){e(0,r=await lt(u.reviews));for(const c of r)h[c.userId]||e(1,h[c.userId]=await d(c.userId),h),a?e(2,n[c.id]=c.userLikes.includes(a.id),n):e(2,n[c.id]=!1,n),e(3,_[c.id]=c.likes,_),E[c.id]=!1}}catch(a){console.error("Failed to fetch album data:",a)}});async function w(a){let u=localStorage.getItem("token"),c=pe.fromObject(JSON.parse(localStorage.getItem("user")||""));if(!(!u||!c)){if(E[a]){console.log("Please wait before liking again.");return}n[a]?e(3,_[a]-=1,_):e(3,_[a]+=1,_),e(2,n[a]=!n[a],n);try{await at(a,u,_[a],c.id),console.log("Review like updated successfully")}catch(g){console.error("Error updating review like:",g),e(2,n[a]=!n[a],n),e(3,_[a]+=n[a]?1:-1,_)}E[a]=!0,setTimeout(()=>{E[a]=!1},2e3)}}function p(a){return a.length>Me?a.slice(0,Me)+"...":a}const q=a=>w(a.id);return l.$$set=a=>{"id"in a&&e(6,s=a.id),"reviews"in a&&e(0,r=a.reviews)},[r,h,n,_,w,p,s,q]}class vt extends ke{constructor(t){super(),Ee(this,t,_t,mt,be,{id:6,reviews:0})}}function dt(l){let t,e,s,r,h,n,_,E,d="Reviews recientes",w,p,q;return t=new Ye({}),h=new ht({props:{id:l[0].id}}),p=new vt({props:{id:l[0].id}}),{c(){he(t.$$.fragment),e=N(),s=b("main"),r=b("section"),he(h.$$.fragment),n=N(),_=b("section"),E=b("h2"),E.textContent=d,w=N(),he(p.$$.fragment),this.h()},l(a){me(t.$$.fragment,a),e=P(a),s=k(a,"MAIN",{class:!0});var u=I(s);r=k(u,"SECTION",{class:!0});var c=I(r);me(h.$$.fragment,c),c.forEach(f),n=P(u),_=k(u,"SECTION",{class:!0});var g=I(_);E=k(g,"H2",{class:!0,"data-svelte-h":!0}),ne(E)!=="svelte-ocb0vo"&&(E.textContent=d),w=P(g),me(p.$$.fragment,g),g.forEach(f),u.forEach(f),this.h()},h(){i(r,"class","section-body"),i(E,"class","section-title"),i(_,"class","section-body"),i(s,"class","svelte-ki07hp")},m(a,u){_e(t,a,u),y(a,e,u),y(a,s,u),o(s,r),_e(h,r,null),o(s,n),o(s,_),o(_,E),o(_,w),_e(p,_,null),q=!0},p(a,[u]){const c={};u&1&&(c.id=a[0].id),h.$set(c);const g={};u&1&&(g.id=a[0].id),p.$set(g)},i(a){q||(ve(t.$$.fragment,a),ve(h.$$.fragment,a),ve(p.$$.fragment,a),q=!0)},o(a){de(t.$$.fragment,a),de(h.$$.fragment,a),de(p.$$.fragment,a),q=!1},d(a){a&&(f(e),f(s)),ge(t,a),ge(h),ge(p)}}}function gt(l,t,e){let{data:s}=t;return l.$$set=r=>{"data"in r&&e(0,s=r.data)},[s]}class St extends ke{constructor(t){super(),Ee(this,t,gt,dt,be,{data:0})}}export{St as component,Rt as universal};
